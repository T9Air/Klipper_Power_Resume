[gcode_shell_command add_logs]
command: bash ~/Klipper_Power_Resume/Interface_scripts/add_logs.sh "{param_FILENAME}" "{param_MODE}" "{param_LINES}" "{printer_base_path}"
timeout: 300.0
verbose: True

[gcode_shell_command get_config_path]
command: bash ./get_config_path.sh
timeout: 2.0
verbose: False

[gcode_macro ADD_LOGS]
description: Add logging commands to a G-code file
variable_printer_base_path: ""
gcode:
    {% set filename = params.FILENAME|default(None) %}
    {% set line_based = params.LINE_BASED|default("yes") %}
    {% set lines = params.LINES|default("5") %}
    
    {% if filename %}
        {% if not filename.lower().endswith('.gcode') %}
            {% set filename = filename ~ '.gcode' %}
        {% endif %}
        {% set path = printer.run_shell_command('get_config_path').output.strip() %}
        {% set full_filename = path ~ "/gcodes/" ~ filename %}
        RUN_SHELL_COMMAND CMD=add_logs FILENAME={full_filename} MODE={line_based} LINES={lines}
    {% else %}
        RESPOND TYPE=error MSG="No filename provided. Usage: ADD_LOGS FILENAME=my_print.gcode [LINE_BASED=yes|no] [LINES=5]"
    {% endif %}